<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Multi Service</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-0evHe/X+R7YkIZDRvuzKMRqM+OrBnVFBL6DOitfPri4tjfHxaWutUpFmBp4vmVor" crossorigin="anonymous">
</head>
<body>
<div class="container p-0 d-flex flex-column justify-content-center align-items-center">
    <select id="list" class="mt-4" style=" width: 20rem" >
        <option value=""></option>
        <option value="Airport Info">Airport Info</option>
        <option value="Corona Data">Corona Data</option>
        <option value="Twitch Games Popularity">Twitch Games Popularity</option>
    </select><br>

    <div class="buildCard"></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/js/bootstrap.bundle.min.js" integrity="sha384-pprn3073KE6tl6bjs2QrFaJGz5/SUsLqktiwsUTF55Jfv3qYSDhgCecCxMW52nD2" crossorigin="anonymous"></script>
<script>

    class Choice {
        constructor(host, url) {
            this.host = host;
            this.url = url;
        }
    }

    class Aereoporto {
        constructor(name, location, state) {
            this.name = name;
            this.location = location;
            this.state = state;
        }
    }


    class Corona {
        constructor(TotalCases, NewCases, TotalDeaths, NewDeaths) {
            this.TotalCases = TotalCases;
            this.NewCases = NewCases;
            this.TotalDeaths = TotalDeaths;
            this.NewDeaths = NewDeaths;
        }
    }

    class Game {
        constructor(Month, Year, Hours_watched, Avg_viewer_ratio) {
            this.Month = Month;
            this.Year = Year;
            this.Hours_watched = Hours_watched;
            this.Avg_viewer_ratio = Avg_viewer_ratio;
        }
    }



    const getApiResponse = async function ()
    {
        const options = {
            method: 'GET',
            headers: {
                'X-RapidAPI-Host': getApiBasedOnApiChoice(userChoice()).host,
                'X-RapidAPI-Key': '81d480c8b9mshe4ecc690cab5011p149bfejsndf734379f559'
            }
        };

        const response = await fetch(getApiBasedOnApiChoice(userChoice()).url, options)
        const status = response.ok;
        if(status){

            return await response.json();
        }else{
            throw new Error("Invalid");
        }
    }

    const choices = [];

    function getUserChoice()
    {
        const choice = document.getElementById("list");
        choice.addEventListener("change", (e) =>
        {
            getApiResponse().then(result => {
                if(userChoice() === "Airport Info")
                {
                    const aereoporto = new Aereoporto(result.name, result.location, result.state);

                    populateAirportHtml(aereoporto);
                }
                else if(userChoice() === "Corona Data")
                {
                    const corona = new Corona(result[0].TotalCases, result[0].NewCases, result[0].TotalDeaths, result[0].NewDeaths);

                    populateCoronaHtml(corona);
                }
                else if (userChoice() === "Twitch Games Popularity"){
                    const game = new Game(result[0].Month, result[0].Year, result[0].Hours_watched, result[0].Avg_viewer_ratio);
                    populateGameHtml(game);

                }
            })
        })
    }

    function userChoice()
    {
        const elementTaken = document.getElementById("list").value;
        if(typeof elementTaken === 'string')
        {
            // spanEl.innerHTML = elementTaken;
            const element = elementTaken;
            choices.splice(0, 1, element);
            return element;
        }
        else
            throw new Error("C'Ã¨ qualcosa che nn va");
    }

    function getApiBasedOnApiChoice(choice)
    {
        switch (choice)
        {
            case "Airport Info":
                const hostAirport = 'airport-info.p.rapidapi.com';
                const urlAirport = 'https://airport-info.p.rapidapi.com/airport?iata=AAB';
                return new Choice(hostAirport, urlAirport);
            case "Corona Data":
                const hostCorona = 'vaccovid-coronavirus-vaccine-and-treatment-tracker.p.rapidapi.com';
                const urlCorona = 'https://vaccovid-coronavirus-vaccine-and-treatment-tracker.p.rapidapi.com/api/npm-covid-data/world';
                return new Choice(hostCorona, urlCorona);
            case "Twitch Games Popularity":
                const hostTwitch = 'twitch-game-popularity.p.rapidapi.com';
                const urlTwitch = 'https://twitch-game-popularity.p.rapidapi.com/game?name=League%20of%20Legends&year=2020&month=08';
                return new Choice(hostTwitch, urlTwitch);
            default:
                console.log("non va bene");
        }
    }

    function populateAirportHtml(Airport)
    {
        const divAirportEl = document.querySelector(".buildCard");
        divAirportEl.innerHTML = `<div class="card my-2" style="width: 20rem;">
                           <img src="/assets/aereo.jpg" class="card-img-top" alt="aereo">
                           <div class="card-body">
                           <h5 class="card-title">Airport Info</h5>
                           <ul>
                           <li>${Airport.name}</li>
                           <li>${Airport.location}</li>
                           <li>${Airport.state}</li>
                           </ul>
                           </div>
                           </div>`
    }

    function populateCoronaHtml(Corona)
    {
        const divCoronaEl = document.querySelector(".buildCard");
        divCoronaEl.innerHTML = `<div class="card my-2" style="width: 20rem;">
                           <img src="/assets/corona.png" class="card-img-top" alt="corona">
                           <div class="card-body">
                           <h5 class="card-title">Corona Data</h5>
                           <ul>
                           <li>${Corona.TotalCases}</li>
                           <li>${Corona.NewCases}</li>
                           <li>${Corona.TotalDeaths}</li>
                           <li>${Corona.NewDeaths}</li>
                           </ul>
                           </div>
                           </div>`
    }

    function populateGameHtml(Game){
        const divGameEl = document.querySelector(".buildCard");
        divGameEl.innerHTML = `<div class="card my-2" style="width: 20rem;">
                           <img src="/assets/twitch.png" class="card-img-top" alt="Game">
                           <div class="card-body">
                           <h5 class="card-title">Twitch Info</h5>
                           <ul>
                           <li>${Game.Month}</li>
                           <li>${Game.Year}</li>
                           <li>${Game.Hours_watched}</li>
                           <li>${Game.Avg_viewer_ratio}</li>
                           </ul>
                           </div>
                           </div>`
    }

    getUserChoice();

    // console.log(getGameResponse('https://twitch-game-popularity.p.rapidapi.com/game?name=League%20of%20Legends&year=2020&month=08'));
    // console.log(getGameResponse('https://twitch-game-popularity.p.rapidapi.com/game?name=Minecraft&year=2020&month=08'));
    // console.log(getGameResponse('https://twitch-game-popularity.p.rapidapi.com/game?name=Fortnite&year=2020&month=08'));
    // console.log(getGameResponse('https://twitch-game-popularity.p.rapidapi.com/game?name=7%20Days%20to%20Die&year=2020&month=08'));

    // League of Legends https://twitch-game-popularity.p.rapidapi.com/game?name=League%20of%20Legends&year=2020&month=08

    // Minecraft https://twitch-game-popularity.p.rapidapi.com/game?name=Minecraft&year=2020&month=08

    // Fortnite https://twitch-game-popularity.p.rapidapi.com/game?name=Fortnite&year=2020&month=08

    // 7 Days to Die https://twitch-game-popularity.p.rapidapi.com/game?name=7%20Days%20to%20Die&year=2020&month=08

</script>
</body>
</html>